<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Track collective events — trackCollEvents • ARCOS</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Track collective events — trackCollEvents" />
<meta property="og:description" content="Track spatial clusters of objects between frames of a time series. Positions of objects should be supplied
in a long-format data.table with at least 3 columns:
frame number, position (1, 2, or 3 columns), and the object id.
The frame number should be an integer, the object ID may be a string or an integer, and the object position has to be numeric (an integer or a float)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ARCOS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ARCOS-advanced.html">Advanced usage of ARCOS</a>
    </li>
    <li>
      <a href="../articles/ARCOS-basics.html">Basic usage of ARCOS</a>
    </li>
    <li>
      <a href="../articles/ARCOS-synth2D.html">ARCOS detect from images</a>
    </li>
    <li>
      <a href="../articles/ARCOS-tests.html">ARCOS demo of synthetic test</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Track collective events</h1>
    
    <div class="hidden name"><code>trackCollEvents.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Track spatial clusters of objects between frames of a time series. Positions of objects should be supplied
in a long-format data.table with at least 3 columns:
frame number, position (1, 2, or 3 columns), and the object id.
The frame number should be an integer, the object ID may be a string or an integer, and the object position has to be numeric (an integer or a float).</p>
    </div>

    <pre class="usage"><span class='fu'>trackCollEvents</span><span class='op'>(</span>
  <span class='va'>dt</span>,
  eps <span class='op'>=</span> <span class='fl'>1</span>,
  minClSz <span class='op'>=</span> <span class='fl'>1L</span>,
  nPrev <span class='op'>=</span> <span class='fl'>1L</span>,
  cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>frame <span class='op'>=</span> <span class='st'>"time"</span>, id <span class='op'>=</span> <span class='st'>"trackID"</span>, clid <span class='op'>=</span> <span class='st'>"clTrackID"</span><span class='op'>)</span>,
  posCols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span><span class='op'>)</span>,
  deb <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dt</th>
      <td><p>a data.table with time series in the long format with at least 3 columns: integer frame number, object id, object position.</p></td>
    </tr>
    <tr>
      <th>eps</th>
      <td><p>a float with the search radius, default 1.</p></td>
    </tr>
    <tr>
      <th>minClSz</th>
      <td><p>an integer with the minimum size of the cluster, default 1L.</p></td>
    </tr>
    <tr>
      <th>nPrev</th>
      <td><p>an integer with the number of previous frames to search for an event, default 1L.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>a list with column names, <code><a href='https://rdrr.io/r/base/list.html'>list(frame = , id = , clid = )</a></code>, that correspond to the integer frame number, object id and id of collective events, respectively.</p></td>
    </tr>
    <tr>
      <th>posCols</th>
      <td><p>a vector with names of position columns, default <code><a href='https://rdrr.io/r/base/c.html'>c("x")</a></code>.</p></td>
    </tr>
    <tr>
      <th>deb</th>
      <td><p>logical, whether to output debug information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a data.table with cluster numbers and id's of the corresponding objects</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Thanks to long format, every frame contains at least one object, however, frames do not need to be consecutive.
Objects are searched at least one frame back. Adjust the length of the search history with <code>nPrev</code>.</p>
<p>The algorithm first spatially clusters objects independently in every frame,
then propagates cluster numbers to clusters in consecutive frames, if at least one objects is within a threshold distance.
Spatial clustering is performed using <code><a href='https://rdrr.io/pkg/dbscan/man/dbscan.html'>dbscan::dbscan</a></code> and the nearest-neighbour (NN) distance is calculated with the <code><a href='https://rdrr.io/pkg/RANN/man/nn2.html'>RANN::nn2</a></code> function.</p>
<p>The algorithm proceeds as follows:</p>
<p>spatially cluster objects independently in every frame; the resulting cluster IDs are unique for the entire time sequence
**for** every frame <code>i</code>
   search for objects in <code>nPrev</code> frames
   **for** every cluster in the current frame <code>k</code>
      calculate the NN distance between objects in cluster <code>k</code> and all objects from all clusters in <code>nPrev</code> frame(s)
      **if** the NN distance is below the threshold
         change the cluster ID of all objects in cluster <code>k</code> to that of the closest object in <code>nPrev</code> frame(s)
   **end for** every cluster
**end for** every frame</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>ARCOS</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>

<span class='va'>dt</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>frame <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>5</span><span class='op'>)</span>,
                id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>1</span>, <span class='fl'>4</span><span class='op'>)</span>,
                x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span>, <span class='fl'>1.2</span>, <span class='fl'>2.5</span>, <span class='fl'>3.5</span>, <span class='fl'>0.9</span>, <span class='fl'>2.6</span>, <span class='fl'>2.9</span>, <span class='fl'>3.2</span>, <span class='fl'>1.1</span>, <span class='fl'>2.8</span>, <span class='fl'>3.1</span>, <span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>dtColl</span> <span class='op'>=</span> <span class='fu'>ARCOS</span><span class='fu'>:::</span><span class='fu'>trackCollEvents</span><span class='op'>(</span><span class='va'>dt</span>,
                        eps <span class='op'>=</span> <span class='fl'>0.6</span>,
                        minClSz <span class='op'>=</span> <span class='fl'>1L</span>,
                        nPrev <span class='op'>=</span> <span class='fl'>1L</span>,
                        cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>frame <span class='op'>=</span> <span class='st'>"frame"</span>,
                                      id <span class='op'>=</span> <span class='st'>"id"</span>,
                                      clid <span class='op'>=</span> <span class='st'>"collId"</span><span class='op'>)</span>,
                        posCols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span><span class='op'>)</span>,
                        deb <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>dt</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>dt</span>, <span class='va'>dtColl</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"frame"</span>, <span class='st'>"id"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>dt</span>,
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>,
          y <span class='op'>=</span> <span class='va'>frame</span>,
          color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>id</span><span class='op'>)</span>,
          group <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>shape <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>collId</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_shape.html'>scale_shape_discrete</a></span><span class='op'>(</span><span class='st'>"Collective id:"</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html'>scale_color_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Object id:"</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='img'><img src='trackCollEvents-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Maciej Dobrzyński.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


