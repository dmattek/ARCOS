<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Track collective events — trackCollEvents • ARCOS</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Track collective events — trackCollEvents"><meta property="og:description" content="Track spatial clusters of objects between frames of a time series. Positions of objects should be supplied
in a long-format data.table with at least 3 columns:
frame number, position (1, 2, or 3 columns), and the object id.
The frame number should be an integer, the object ID may be a string or an integer, and the object position has to be numeric (an integer or a float)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ARCOS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ARCOS-basics.html">Basic usage of ARCOS</a>
    </li>
    <li>
      <a href="../articles/ARCOS-binTimeseries.html">Pre-processing time-series for ARCOS</a>
    </li>
    <li>
      <a href="../articles/ARCOS-randomisation.html">Testing significance of collective events with randomisation</a>
    </li>
    <li>
      <a href="../articles/ARCOS-synthRand2D.html">Detect synthetic random collective events</a>
    </li>
    <li>
      <a href="../articles/ARCOS-synthRasterImages.html">Detect collective events from images</a>
    </li>
    <li>
      <a href="../articles/ARCOS-unitTests.html">ARCOS demo of unit tests</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dmattek/ARCOS/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Track collective events</h1>
    <small class="dont-index">Source: <a href="https://github.com/dmattek/ARCOS/blob/HEAD/R/trackCollEvents.R" class="external-link"><code>R/trackCollEvents.R</code></a></small>
    <div class="hidden name"><code>trackCollEvents.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Track spatial clusters of objects between frames of a time series. Positions of objects should be supplied
in a long-format data.table with at least 3 columns:
frame number, position (1, 2, or 3 columns), and the object id.
The frame number should be an integer, the object ID may be a string or an integer, and the object position has to be numeric (an integer or a float).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trackCollEvents</span><span class="op">(</span></span>
<span>  <span class="va">dt</span>,</span>
<span>  eps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  minClSz <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  nPrev <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  epsPrev <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="st">"time"</span>, id <span class="op">=</span> <span class="st">"trackID"</span>, clid <span class="op">=</span> <span class="st">"clTrackID"</span><span class="op">)</span>,</span>
<span>  posCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span>,</span>
<span>  deb <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dt</dt>
<dd><p>a data.table with time series in the long format with at least 3 columns: integer frame number, object id, object position.</p></dd>


<dt>eps</dt>
<dd><p>a float with the search radius for spatial clustering with dbscan, default 1.</p></dd>


<dt>minClSz</dt>
<dd><p>an integer with the minimum size of the spatial cluster in dbscan, default 1L.</p></dd>


<dt>nPrev</dt>
<dd><p>an integer with the number of previous frames to search for an event, default 1L.</p></dd>


<dt>epsPrev</dt>
<dd><p>a float with the search radius for linking clusters between frames, default NULL means that epsPrev = eps.</p></dd>


<dt>cols</dt>
<dd><p>a list with column names, <code>list(frame = , id = , clid = )</code>, that correspond to the integer frame number, object id and id of collective events, respectively.</p></dd>


<dt>posCols</dt>
<dd><p>a vector with names of position columns, default <code>c("x")</code>.</p></dd>


<dt>deb</dt>
<dd><p>logical, whether to output debug information.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a data.table with cluster numbers and id's of the corresponding objects</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Thanks to long format, every frame contains at least one object, however, frames do not need to be consecutive.
Objects are searched at least one frame back. Adjust the length of the search history with <code>nPrev</code>.</p>
<p>The algorithm first spatially clusters objects independently in every frame,
then propagates cluster numbers to clusters in consecutive frames, if at least one objects is within a threshold distance.
Spatial clustering is performed using <code><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html" class="external-link">dbscan::dbscan</a></code> and the nearest-neighbour (NN) distance is calculated with the <code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2</a></code> function.</p>
<p>The algorithm proceeds as follows:</p>
<p>spatially cluster objects independently in every frame; the resulting cluster IDs are unique for the entire time sequence
**for** every frame <code>i</code>
   search for objects in <code>nPrev</code> frames
   **for** every cluster in the current frame <code>k</code>
      calculate the NN distance between objects in cluster <code>k</code> and all objects from all clusters in <code>nPrev</code> frame(s)
      **if** the NN distance is below the threshold
         change the cluster ID of all objects in cluster <code>k</code> to that of the closest object in <code>nPrev</code> frame(s)
   **end for** every cluster
**end for** every frame</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmattek/ARCOS" class="external-link">ARCOS</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">0.9</span>, <span class="fl">2.6</span>, <span class="fl">2.9</span>, <span class="fl">3.2</span>, <span class="fl">1.1</span>, <span class="fl">2.8</span>, <span class="fl">3.1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dtColl</span> <span class="op">=</span> <span class="fu">ARCOS</span><span class="fu">:::</span><span class="fu">trackCollEvents</span><span class="op">(</span><span class="va">dt</span>,</span></span>
<span class="r-in"><span>                        eps <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>                        minClSz <span class="op">=</span> <span class="fl">1L</span>,</span></span>
<span class="r-in"><span>                        nPrev <span class="op">=</span> <span class="fl">1L</span>,</span></span>
<span class="r-in"><span>                        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="st">"frame"</span>,</span></span>
<span class="r-in"><span>                                      id <span class="op">=</span> <span class="st">"id"</span>,</span></span>
<span class="r-in"><span>                                      clid <span class="op">=</span> <span class="st">"collId"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        posCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        deb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">dtColl</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"frame"</span>, <span class="st">"id"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dt</span>,</span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,</span></span>
<span class="r-in"><span>          y <span class="op">=</span> <span class="va">frame</span>,</span></span>
<span class="r-in"><span>          color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">collId</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html" class="external-link">scale_shape_discrete</a></span><span class="op">(</span><span class="st">"Collective id:"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Object id:"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="trackCollEvents-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Maciej Dobrzyński.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

